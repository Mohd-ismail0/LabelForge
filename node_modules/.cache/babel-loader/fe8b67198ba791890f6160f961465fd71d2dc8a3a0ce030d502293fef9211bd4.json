{"ast":null,"code":"import JsBarcode from 'jsbarcode';\n\n// Shared label rendering utilities to ensure consistency between design and generation\n\nexport const LABEL_SIZES = {\n  '2x1': {\n    width: 2,\n    height: 1,\n    dpi: 300\n  },\n  '3x1': {\n    width: 3,\n    height: 1,\n    dpi: 300\n  },\n  '2.5x1': {\n    width: 2.5,\n    height: 1,\n    dpi: 300\n  },\n  '4x2': {\n    width: 4,\n    height: 2,\n    dpi: 300\n  },\n  'custom': {\n    width: 2,\n    height: 1,\n    dpi: 300\n  }\n};\nexport const renderBarcode = (barcode, barcodeType, width, height, showText = true) => {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n\n  // Set canvas size\n  canvas.width = width;\n  canvas.height = height;\n\n  // Fill background\n  ctx.fillStyle = 'white';\n  ctx.fillRect(0, 0, width, height);\n  try {\n    // Generate barcode\n    const barcodeCanvas = document.createElement('canvas');\n    JsBarcode(barcodeCanvas, barcode, {\n      format: barcodeType,\n      width: 2,\n      height: height * 0.6,\n      displayValue: showText,\n      fontSize: Math.max(8, height * 0.15),\n      margin: 5\n    });\n\n    // Draw barcode centered\n    const barcodeX = (width - barcodeCanvas.width) / 2;\n    const barcodeY = (height - barcodeCanvas.height) / 2;\n    ctx.drawImage(barcodeCanvas, barcodeX, barcodeY);\n    return canvas;\n  } catch (error) {\n    console.error('Error generating barcode:', error);\n    // Draw error text\n    ctx.fillStyle = 'red';\n    ctx.font = '12px Arial';\n    ctx.textAlign = 'center';\n    ctx.fillText('Invalid Barcode', width / 2, height / 2);\n    return canvas;\n  }\n};\nexport const renderText = (text, style, width, height) => {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n\n  // Set canvas size\n  canvas.width = width;\n  canvas.height = height;\n\n  // Fill background\n  ctx.fillStyle = 'white';\n  ctx.fillRect(0, 0, width, height);\n\n  // Set text properties\n  ctx.fillStyle = style.color || '#000000';\n  ctx.font = `${style.fontWeight || 'normal'} ${style.fontSize || 12}px Arial`;\n  ctx.textAlign = style.textAlign || 'left';\n  ctx.textBaseline = 'middle';\n\n  // Calculate text position\n  let x, y;\n  switch (style.textAlign) {\n    case 'center':\n      x = width / 2;\n      break;\n    case 'right':\n      x = width - 5;\n      break;\n    default:\n      x = 5;\n  }\n  y = height / 2;\n\n  // Draw text\n  ctx.fillText(text, x, y);\n  return canvas;\n};\nexport const renderLabel = (labelData, labelSettings, elements = []) => {\n  const currentSize = LABEL_SIZES[labelSettings.size] || LABEL_SIZES['2x1'];\n  const size = labelSettings.size === 'custom' ? {\n    width: labelSettings.customWidth,\n    height: labelSettings.customHeight\n  } : currentSize;\n  const dpi = currentSize.dpi;\n  const width = size.width * dpi;\n  const height = size.height * dpi;\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n\n  // Set canvas size\n  canvas.width = width;\n  canvas.height = height;\n\n  // Fill background\n  ctx.fillStyle = 'white';\n  ctx.fillRect(0, 0, width, height);\n\n  // If no elements defined, use default layout\n  if (elements.length === 0) {\n    // Default: barcode centered, text below\n    const barcodeHeight = height * 0.6;\n    const barcodeCanvas = renderBarcode(labelData.barcode, labelSettings.barcodeType, width * 0.8, barcodeHeight, true);\n    const barcodeX = (width - barcodeCanvas.width) / 2;\n    const barcodeY = height * 0.1;\n    ctx.drawImage(barcodeCanvas, barcodeX, barcodeY);\n\n    // Add text if available\n    if (labelData.text) {\n      ctx.fillStyle = 'black';\n      ctx.font = '16px Arial';\n      ctx.textAlign = 'center';\n      const textY = height * 0.8;\n      ctx.fillText(labelData.text, width / 2, textY);\n    }\n  } else {\n    // Render each element\n    elements.forEach(element => {\n      if (element.type === 'barcode') {\n        const elementCanvas = renderBarcode(labelData.barcode, labelSettings.barcodeType, element.size.width * (dpi / 96),\n        // Convert from display pixels to print pixels\n        element.size.height * (dpi / 96));\n        const x = element.position.x * (dpi / 96);\n        const y = element.position.y * (dpi / 96);\n        ctx.drawImage(elementCanvas, x, y);\n      } else if (element.type === 'text') {\n        // Replace placeholder text with actual data\n        let textContent = element.content;\n        if (labelData.text && textContent.includes('Sample')) {\n          textContent = labelData.text;\n        }\n        const elementCanvas = renderText(textContent, element.style, element.size.width * (dpi / 96), element.size.height * (dpi / 96));\n        const x = element.position.x * (dpi / 96);\n        const y = element.position.y * (dpi / 96);\n        ctx.drawImage(elementCanvas, x, y);\n      }\n    });\n  }\n  return canvas;\n};","map":{"version":3,"names":["JsBarcode","LABEL_SIZES","width","height","dpi","renderBarcode","barcode","barcodeType","showText","canvas","document","createElement","ctx","getContext","fillStyle","fillRect","barcodeCanvas","format","displayValue","fontSize","Math","max","margin","barcodeX","barcodeY","drawImage","error","console","font","textAlign","fillText","renderText","text","style","color","fontWeight","textBaseline","x","y","renderLabel","labelData","labelSettings","elements","currentSize","size","customWidth","customHeight","length","barcodeHeight","textY","forEach","element","type","elementCanvas","position","textContent","content","includes"],"sources":["/workspace/src/utils/labelRenderer.js"],"sourcesContent":["import JsBarcode from 'jsbarcode';\n\n// Shared label rendering utilities to ensure consistency between design and generation\n\nexport const LABEL_SIZES = {\n  '2x1': { width: 2, height: 1, dpi: 300 },\n  '3x1': { width: 3, height: 1, dpi: 300 },\n  '2.5x1': { width: 2.5, height: 1, dpi: 300 },\n  '4x2': { width: 4, height: 2, dpi: 300 },\n  'custom': { width: 2, height: 1, dpi: 300 }\n};\n\nexport const renderBarcode = (barcode, barcodeType, width, height, showText = true) => {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  \n  // Set canvas size\n  canvas.width = width;\n  canvas.height = height;\n  \n  // Fill background\n  ctx.fillStyle = 'white';\n  ctx.fillRect(0, 0, width, height);\n  \n  try {\n    // Generate barcode\n    const barcodeCanvas = document.createElement('canvas');\n    JsBarcode(barcodeCanvas, barcode, {\n      format: barcodeType,\n      width: 2,\n      height: height * 0.6,\n      displayValue: showText,\n      fontSize: Math.max(8, height * 0.15),\n      margin: 5\n    });\n    \n    // Draw barcode centered\n    const barcodeX = (width - barcodeCanvas.width) / 2;\n    const barcodeY = (height - barcodeCanvas.height) / 2;\n    ctx.drawImage(barcodeCanvas, barcodeX, barcodeY);\n    \n    return canvas;\n  } catch (error) {\n    console.error('Error generating barcode:', error);\n    // Draw error text\n    ctx.fillStyle = 'red';\n    ctx.font = '12px Arial';\n    ctx.textAlign = 'center';\n    ctx.fillText('Invalid Barcode', width / 2, height / 2);\n    return canvas;\n  }\n};\n\nexport const renderText = (text, style, width, height) => {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  \n  // Set canvas size\n  canvas.width = width;\n  canvas.height = height;\n  \n  // Fill background\n  ctx.fillStyle = 'white';\n  ctx.fillRect(0, 0, width, height);\n  \n  // Set text properties\n  ctx.fillStyle = style.color || '#000000';\n  ctx.font = `${style.fontWeight || 'normal'} ${style.fontSize || 12}px Arial`;\n  ctx.textAlign = style.textAlign || 'left';\n  ctx.textBaseline = 'middle';\n  \n  // Calculate text position\n  let x, y;\n  switch (style.textAlign) {\n    case 'center':\n      x = width / 2;\n      break;\n    case 'right':\n      x = width - 5;\n      break;\n    default:\n      x = 5;\n  }\n  y = height / 2;\n  \n  // Draw text\n  ctx.fillText(text, x, y);\n  \n  return canvas;\n};\n\nexport const renderLabel = (labelData, labelSettings, elements = []) => {\n  const currentSize = LABEL_SIZES[labelSettings.size] || LABEL_SIZES['2x1'];\n  const size = labelSettings.size === 'custom' \n    ? { width: labelSettings.customWidth, height: labelSettings.customHeight }\n    : currentSize;\n  const dpi = currentSize.dpi;\n  const width = size.width * dpi;\n  const height = size.height * dpi;\n  \n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  \n  // Set canvas size\n  canvas.width = width;\n  canvas.height = height;\n  \n  // Fill background\n  ctx.fillStyle = 'white';\n  ctx.fillRect(0, 0, width, height);\n  \n  // If no elements defined, use default layout\n  if (elements.length === 0) {\n    // Default: barcode centered, text below\n    const barcodeHeight = height * 0.6;\n    const barcodeCanvas = renderBarcode(\n      labelData.barcode,\n      labelSettings.barcodeType,\n      width * 0.8,\n      barcodeHeight,\n      true\n    );\n    \n    const barcodeX = (width - barcodeCanvas.width) / 2;\n    const barcodeY = height * 0.1;\n    ctx.drawImage(barcodeCanvas, barcodeX, barcodeY);\n    \n    // Add text if available\n    if (labelData.text) {\n      ctx.fillStyle = 'black';\n      ctx.font = '16px Arial';\n      ctx.textAlign = 'center';\n      const textY = height * 0.8;\n      ctx.fillText(labelData.text, width / 2, textY);\n    }\n  } else {\n    // Render each element\n    elements.forEach(element => {\n      if (element.type === 'barcode') {\n        const elementCanvas = renderBarcode(\n          labelData.barcode,\n          labelSettings.barcodeType,\n          element.size.width * (dpi / 96), // Convert from display pixels to print pixels\n          element.size.height * (dpi / 96)\n        );\n        \n        const x = element.position.x * (dpi / 96);\n        const y = element.position.y * (dpi / 96);\n        ctx.drawImage(elementCanvas, x, y);\n      } else if (element.type === 'text') {\n        // Replace placeholder text with actual data\n        let textContent = element.content;\n        if (labelData.text && textContent.includes('Sample')) {\n          textContent = labelData.text;\n        }\n        \n        const elementCanvas = renderText(\n          textContent,\n          element.style,\n          element.size.width * (dpi / 96),\n          element.size.height * (dpi / 96)\n        );\n        \n        const x = element.position.x * (dpi / 96);\n        const y = element.position.y * (dpi / 96);\n        ctx.drawImage(elementCanvas, x, y);\n      }\n    });\n  }\n  \n  return canvas;\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}